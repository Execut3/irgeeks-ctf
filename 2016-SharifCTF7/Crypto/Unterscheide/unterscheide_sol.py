#!/usr/bin/python

"""
SharifCTF{10ED2D76BCC417D9C48BE67F6790AF70}
"""
from Crypto.Util.number import *
from Crypto.Cipher import AES

q = 165269599219445291398173635845501465893177201997714520052835716101366991703599089397287042721096067409772119897046741565500293370740283586460353393394630534349929558358109284225649030217655081372910120058487153005673592680613247698577655983823064226042058852387960865050147174483989378148446338590249438249083

p2 = 9090368507916642523150386537322321669636426087368916042946887058939035329547274618743911402935105936038626517888669029591219526735351668782037241444579211
p1 = 9090368507916642523150386537322321669636426087368916042946887058939035329547274618743911402935105936038626517888669029591219526735351668782037241434579031

rand = 27520790357638948793357070133680303498308234098213169355930451551473551610668598275338166450612066732646304998053583305691477103900019807357983049075051458007108229556072342519889701952853559033481920882888665392738949159879012748283810392571373411251358969454208761074291792134766062048754841099848058011309

d = []
for p in open('enc.txt').read().splitlines():
    d.append(int(p))

c = ""

i = 0
for dd in d: 
    l = pow((dd -i - rand-1 )/(rand + i)/q, p1*1023, q)
    if q - 1 == l : 
        c += '1'
    else:
        c += '0'
    i += 1

c = hex(int(c, 2))[2:-1].decode("hex")

key = long_to_bytes(rand)
IV = key[16:32]
mode = AES.MODE_CBC
aes = AES.new(key[:16], mode, IV=IV)

print "flag: ", aes.decrypt(c)

